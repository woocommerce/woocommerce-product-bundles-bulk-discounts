!function(t){var a=function(a){this.filter_bundle_subtotals_data=function(a,i,e){if(a.applied_discount)return a;if(void 0===a.bulk_discount_data)return a;var n=a.quantities,_=a.bulk_discount_data.discount_array,d=0,s=0;if(_.length>0){for(var u in n)s+=n[u];for(var l=0;l<_.length;l++)void 0!==_[l].quantity_min&&void 0!==_[l].quantity_max&&void 0!==_[l].discount&&s>=_[l].quantity_min&&(s<=_[l].quantity_max||""===_[l].quantity_max)&&(d=_[l].discount);if(a.bulk_discount_data.discount=d,d>0){var c=t.extend(!0,{},a);t.each(i.bundled_items,function(t,a){c.prices[a.bundled_item_id]=c.prices[a.bundled_item_id]*(1-d/100)}),"yes"===i.price_data.bulk_discount_data.discount_base&&c.base_price&&(c.base_price=Number(c.base_price)*(1-d/100)),c.applied_discount=!0,c=i.calculate_subtotals(!1,c,e),(c=i.calculate_totals(c)).applied_discount=!1,a.base_price_totals=c.base_price_totals,t.each(i.bundled_items,function(t,i){var e=c["bundled_item_"+i.bundled_item_id+"_totals"];void 0!==e&&(a["bundled_item_"+i.bundled_item_id+"_totals"]=e)})}else a.base_price_totals=a.base_price_subtotals,t.each(i.bundled_items,function(t,i){a["bundled_item_"+i.bundled_item_id+"_totals"]=a["bundled_item_"+i.bundled_item_id+"_subtotals"]})}return a},this.filter_bundle_total_price_html=function(a,i){if(void 0===i.price_data.bulk_discount_data)return a;if(i.price_data.bulk_discount_data.discount&&i.price_data.subtotals.price!==i.price_data.totals.price){var e="",n=t.extend(!0,{},i.price_data);n.totals=n.subtotals,e=i.get_price_html(n);var _='<span class="discount">'+wc_bundle_params.i18n_bulk_discount+"</span>",d='<span class="discount-amount">'+wc_bundle_params.i18n_bulk_discount_value.replace("%v",wc_pb_number_round(i.price_data.bulk_discount_data.discount,2))+"</span>",s='<span class="price-discount">'+wc_bundle_params.i18n_bulk_discount_format.replace("%s",_).replace("%v",d)+"</span>",u=t(a).wrapInner('<span class="price-total"></span>'),l=t(e).wrapInner('<span class="price-subtotal"></span>');l.find("span.total").text(wc_bundle_params.i18n_bulk_discount_subtotal),l.append(s),l.append(u.html()),a=l.prop("outerHTML")}return a},this.initialize=function(){a.filters.add_filter("bundle_subtotals_data",this.filter_bundle_subtotals_data,10,this),a.filters.add_filter("bundle_total_price_html",this.filter_bundle_total_price_html,10,this)}};t(".bundle_form .bundle_data").each(function(){t(this).on("woocommerce-product-bundle-initializing",function(t,i){new a(i).initialize()})})}(jQuery);